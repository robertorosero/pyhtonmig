########################################################################
# Copyright 1991, 1992, 1993, 1994 by Stichting Mathematisch Centrum,
# Amsterdam, The Netherlands.
# 
#                         All Rights Reserved
# 
# Permission to use, copy, modify, and distribute this software and its 
# documentation for any purpose and without fee is hereby granted, 
# provided that the above copyright notice appear in all copies and that
# both that copyright notice and this permission notice appear in 
# supporting documentation, and that the names of Stichting Mathematisch
# Centrum or CWI not be used in advertising or publicity pertaining to
# distribution of the software without specific, written prior permission.
# 
# STICHTING MATHEMATISCH CENTRUM DISCLAIMS ALL WARRANTIES WITH REGARD TO
# THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
# FITNESS, IN NO EVENT SHALL STICHTING MATHEMATISCH CENTRUM BE LIABLE
# FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
# WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
# ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT
# OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
########################################################################

# Toplevel Makefile

MAKE=		make
SHELL=		/bin/sh
INSTALL=	cp

DESTDIR=	/usr/local

SUBDIRS=	Parser Objects Python Modules
SUBDIRSTOO=	Include Lib Doc Misc Demo readline Grammar Extensions Contrib
DISTFILES=	README TODO Makefile configure configure.in
DIST=		$(DISTFILES) $(SUBDIRS) $(SUBDIRSTOO)

all:		python

python:		Makefiles
		for i in $(SUBDIRS); do \
			(echo $$i; cd $$i; $(MAKE) all); \
		done

install:	python
		$(INSTALL) python $(DESTDIR)/bin/python
		@echo If this is your first time, consider make libinstall...

libinstall:
		-if test ! -d $(DESTDIR)/lib/python; \
		then mkdir $(DDESTDIR)/lib/python; \
		fi
		cp -r Lib/* $(DESTDIR)/lib/python
		@echo Ideally, run something to compile all modules now...

maninstall:
		$(INSTALL) Misc/python.man $(DESTDIR)/man/man1/python.1

Makefiles:	config.status
		for i in $(SUBDIRS); do \
			(echo $$i; cd $$i; $(MAKE) Makefile) \
		done

config.status:	configure
		if test -f config.status; \
		then $(SHELL) config.status --recheck; \
		else $(SHELL) configure; \
		fi

recheck:
		$(SHELL) config.status --recheck

configure:	configure.in
		autoconf
		autoheader

tags:		ctags -t Parser/*.[ch] Objects/*.[ch] Python/*.[ch] Include/*.h

TAGS:		etags -t Parser/*.[ch] Objects/*.[ch] Python/*.[ch] Include/*.h

depend:
		for i in $(SUBDIRS); do \
			(echo $$i; cd $$i; $(MAKE) depend); \
		done

localclean:
		-rm -f core *~ [@,#]* *.old *.orig *.rej
		-(cd Include; rm -f *~ [@,#]* *.old *.orig *.rej)

clean:		localclean
		-for i in $(SUBDIRS) $(SUBDIRSTOO); do \
			(echo $$i; cd $$i; \
			 if test -f Makefile; \
			 then $(MAKE) clean; \
			 else $(MAKE) -f Makefile.in clean; \
			 fi); \
		done

localclobber:	localclean
		-rm -f tags TAGS config.status

clobber:	localclobber
		-for i in $(SUBDIRS) $(SUBDIRSTOO); do \
			(echo $$i; cd $$i; \
			 if test -f Makefile; \
			 then $(MAKE) clobber; \
			 else $(MAKE) -f Makefile.in clobber; \
			 fi); \
		done

distclean:	clobber
		-rm -f Include/config.h
		-for i in $(SUBDIRS) $(SUBDIRSTOO); do \
			(echo $$i; cd $$i; \
			 if test -f Makefile.in; \
			 then rm -f Makefile; \
			 fi); \
		done
 
tar:
		tar cf - $(DIST) | compress >dist.tar.Z
